# 执行看板（长期方案：统一到 Actix web-gw-api）

更新时间：2025-09-10 18:06 +08:00

## 里程碑与任务追踪

- [进行中] A1-修复 web-gw-api 编译错误（建立运行时服务并替换 driver_configs 依赖）
  - [完成] 移除 driver_config_monitor 依赖（bootstrap.rs & services/mod.rs）
  - [完成] routes/driver_configs.rs 改为直接使用 `AppState.driver_manager` 实现 start/stop/restart/status
  - [完成] dto.rs 修复 `ApiResponse<Vec<T>>::paginated` 泛型实现
  - [完成] routes/websocket.rs 裁剪未实现字段（保持连接/订阅/广播基础能力）
  - [完成] routes/mod.rs 暂禁 database 路由，避免缺失实现导致编译失败
  - [待办] 在容器构建环境内单独编译 `web-gw-api`（解决本机 OpenSSL/libclang 依赖问题）
- [待办] A1-校验 WebSocket 基础能力（连接/订阅/状态）可编译运行
- [待办] A2-独立启动 Actix(8080/9091)，打通 /system/health 与核心 REST
- [待办] A3-嵌入 Actix 至 edge-gateway，Warp 迁 8180 只读备用
- [待办] A4-前端切换 8080；E2E 验收无告警
- [待办] A5-完善 OpenAPI 与前端类型生成
- [待办] A6-移除 Warp 依赖并清理重复代码

## 当日推进（T+0）

- 创建重构文档集（README + 01~12）
- 看板创建（本文件）
- A1 关键改造：
  - 移除 monitor 路径，统一到 DriverManager（start/stop/restart/status）
  - 修复 DTO 分页构造；裁剪 WS 管理器扩展字段；暂禁 database 路由
  - 规划了最小自动加载逻辑：Modbus 协议按需加载 `modbus-static` 驱动

## 下一步计划（短期）

- 在容器构建环境内执行：`cargo build -p web-gw-api`，记录错误并修复剩余问题
- 补充 `web-gw-api/src/main.rs` 启动脚手架（8080/9091），最小可运行
- 打通 `/system/health`、`/api/v1/driver-configs/*` 全链路，提交阶段性里程碑
- 校验 WebSocket 基础能力（连接/订阅/状态）

## 风险/阻塞

- `driver-manager` 的运行态/实例模型与 web-gw-api 期望不一致，需要适配层解耦
- 若出现大范围类型漂移，需先冻结 DTO 与路由契约，避免反复修改前端
 - 本机构建 web-gw-api 需要 OpenSSL 与 libclang 开发包；优先使用容器构建以复用 CI 环境
